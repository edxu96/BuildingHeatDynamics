---
title: "Simple Linear Regresson of Building Dynamics"
author: Edward J. Xu (<edxu96@outlook.com>)
date: Sept 1, 2019
output: html_notebook
editor_options: 
  chunk_output_type: console
---

```{r, include=FALSE}
rm(list = ls())
```

```{r, results=FALSE}
library(tidyverse)
library(magrittr)
library(MatrixTSA)
library(forecast)
library(ggResidpanel)
options(tibble.width = Inf)
```

```{r, results=FALSE}
ti <- read_csv("~/GitHub/TidyDynamics/data/soenderborg_2day.csv")
ti_winter <- filter(
  ti,
  as.POSIXlt("2011-06-01")$yday < as.POSIXlt(ti$t)$yday &
  as.POSIXlt(ti$t)$yday <= as.POSIXlt("2011-10-01")$yday
  )
ti_winter
```

Get the data from house 3 during the winter in year 2011.

# 1, Simple Linear Regression

```{r, fig.width=6, fig.height=3}
lm_winter_3 <- lm(P3 ~ Te, ti_winter)
tidy(lm_winter_3)
glance(lm_winter_3)
augment(lm_winter_3)
summary(lm_winter_3)
```

```{r, fig.align="center", fig.cap="Linear Reg of Heating Load (y) and Ext Temp (x) in Winter"}
resid_panel(lm_winter_3, plots = "R", smoother = TRUE)
```

The P-values of coefficients for intercept and `Te` are sufficiently small, so  it's a good model. However, from the top-left diagram, we can say the residuals are not iid.

```{r, fig.align="center", fig.cap="Linear Reg of Heating Load (y) and Ext Temp (x) in Entire Period"}
lm_3 <- lm(P3 ~ Te, ti)
summary(lm_3)
```

```{r}
resid_panel(lm_3, plots = "R", smoother = TRUE)
```

When including the entire period, the span of the data is extended. There are more large residuals.

```{r, fig.cap="ACF of Residuals from Linear Reg Model `lm_winter_3`"}
forecast::ggtsdisplay(
  lm_winter_3$residuals, lag.max = 30, 
  main = "ACF and PACF of Residuals from `lm_winter_3`"
  )
```

```{r, fig.cap="ACF of Residuals from Linear Reg Model `lm_3`"}
forecast::ggtsdisplay(
  lm_3$residuals, lag.max = 30, 
  main = "ACF and PACF of Residuals from `lm_winter_3`"
  )
```

The residuals from `lm_winter_3` are more correlated with each other than those from `lm_3`. The heating loads in summer may cause the difference.

# 2, Regression Splines

```{r}
li_splines <- reg_splines(
  li = c(x = datf$Te, y = datf$P3),
  df = 3, degree = 1, whe_intercept = T
)

plot_splines(li_splines)
```


